IP address wildcard certificate validation
==========================================

Project curl Security Advisory, Match 26th 2014
[Permalink](https://curl.se/docs/CVE-2014-0139.html)

VULNERABILITY
-------------

libcurl incorrectly validates wildcard SSL certificates containing literal
IP addresses.

RFC 2818 covers the requirements for matching Common Names (CNs) and
subjectAltNames in order to establish valid SSL connections. It first
discusses CNs that are for hostnames, and the rules for wildcards in this
case. The next paragraph in the RFC then discusses CNs that are IP addresses:

'In some cases, the URI is specified as an IP address rather than a
hostname. In this case, the `iPAddress` subjectAltName must be present in the
certificate and must exactly match the IP in the URI.'

The intention of the RFC is clear in that you should not be able to use
wildcards with IP addresses (in order to avoid the ability to perform
man-in-the-middle attacks). Unfortunately libcurl fails to adhere to this
rule under certain conditions, and subsequently it would allow and use a
wildcard match specified in the CN field.

Exploiting this flaw, a malicious server could participate in a MITM attack or
just easier fool users that it is a legitimate site for whatever purpose, when
it actually is not.

A good CA should refuse to issue a certificate with the CN as indicated,
however there only need be one CA to issue one in error for this issue to
result in the user getting no warning at all and being vulnerable to MITM.

This flaw is only present in libcurl when built to use one out of a few
specific TLS libraries: OpenSSL, axTLS, qsossl or gskit.

This problem is similar to one previously reported by Richard Moore, found in
multiple browsers.

INFO
----

The Common Vulnerabilities and Exposures (CVE) project has assigned the name
CVE-2014-0139 to this issue.

CWE-297: Improper Validation of Certificate with Host Mismatch

Severity: Medium

AFFECTED VERSIONS
-----------------

This flaw has existed ever since libcurl started to support SSL or TLS with
OpenSSL and certificate wildcards.

- Affected versions: from curl 7.10.3 to and including 7.35.0
- Not affected versions: curl < 7.10.3 and curl >= 7.36.0

libcurl is used by many applications, but not always advertised as such!

SOLUTION
--------

libcurl 7.36.0 has an improved hostname verification function that rejects
wildcard matching against IP addresses.

- Fixed-in: https://github.com/curl/curl/commit/5019c780958c3a8dbe64123aa9

RECOMMENDATIONS
---------------

We suggest you take one of the following actions immediately, in order of
preference:

 A - Upgrade to curl and libcurl 7.36.0

 B - Apply the patch and rebuild libcurl

 C - Build libcurl to use a different TLS backend

TIMELINE
---------

It was reported to the curl project on February 22 2014. We contacted
distros@openwall on March 16 2014.

libcurl 7.36.0 was released on March 26 2014, coordinated with the
publication of this advisory.

CREDITS
-------

- Reported-by: Richard Moore
- Patched-by: Daniel Stenberg

Thanks a lot!
